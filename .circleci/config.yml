version: 2

jobs:
  build:
    docker:
    - image: circleci/node:10.11.0
    steps:
    - checkout
    - run: yarn --ignore-engines --cwd functions install
    - run: yarn --ignore-engines --cwd functions run lint
    - run: yarn --ignore-engines --cwd functions run build

  test:
    docker:
    - image: circleci/node:10.11.0
    steps:
    - checkout
    - run: yarn --ignore-engines --cwd functions
    # TODO: write some tests and run them here

  deploy:
    docker:
    - image: circleci/node:10.11.0
    steps:
    - checkout
    - run: sh scripts/deploy.sh

workflows:
  version: 2
  commit:
    jobs:
    - build
    - test:
        requires:
        - build
    - deploy:
        requires:
        - test
        # filters: # TODO: uncomment
        #   branches:
        #     only: master
